<?xml version="1.0" encoding="iso-8859-1"?>

<!-- NAnt build file for corlib_test.dll -->
<!-- Target build (default) builds tests -->
<!-- Target test runs tests -->

<project name="corlib_test" default="build">
	<property name="debug" value="true"/>
	<property name="nunit_home" value="..\..\..\nunit"/>

	<target name="build">
	</target>

	<target name="assemblies">
		<csc target="library" output="corlib_test.dll" debug="${debug}">
			<sources>
				<includes name="**/*.cs"/>
				<excludes name="TheTests.cs"/>
				<excludes name="System/IntegerFormatterTest.cs"/>
			</sources>
			<references basedir="..\..\..\nunit">
				<includes name="NUnitCore.dll"/>
			</references>
			<arg value="/r:corlib_res.dll"/>
			<arg value="/nowarn:1595"/>
		</csc>

		<csc target="library" output="corlib_reference.dll" debug="${debug}">
			<sources>
				<includes name="**/*.cs"/>
				<excludes name="TheTests.cs"/>
				<excludes name="System/IntegerFormatterTest.cs"/>
			</sources>
			<references basedir="..\..\..\nunit">
				<includes name="NUnitCore.dll"/>
			</references>
			<arg value="/nowarn:1595"/>
		</csc>

		<csc target="exe" output="RunTests.corlib.exe" debug="${debug}">
			<sources>
				<includes name="**/*.cs"/>
				<excludes name="System/IntegerFormatterTest.cs"/>
				<excludes name="System.Collections/StackTest.cs"/>
				<excludes name="**/AllTests.cs"/>
				<excludes name="**/MartinTests.cs"/>
			</sources>
			<references basedir="..\..\..\nunit">
				<includes name="NUnitBase.dll"/>
			</references>
			<arg value="/r:..\..\lib\corlib.dll"/>
			<arg value="/r:..\..\lib\System.dll"/>
			<arg value="/nowarn:1595"/>
			<arg value="/nostdlib"/> 	<!-- don't reference mscorlib -->
			<arg value="/noconfig"/>	<!-- don't reference ms assemblies -->
		</csc>

			<csc target="library" output="corlib_linux_test.dll" debug="${debug}">
			<sources>
				<includes name="**/*.cs"/>
				<excludes name="**/MartinTests.cs"/>
				<excludes name="TheTests.cs"/>
				<excludes name="System/IntegerFormatterTest.cs"/>
				<excludes name="System.Security.Policy/*.cs"/>
			</sources>
			<references basedir="..\..\..\nunit">
				<includes name="NUnitCore_mono.dll"/>
			</references>
			<arg value="/r:..\..\lib\corlib.dll"/>
			<arg value="/r:..\..\lib\System.dll"/>
			<arg value="/nowarn:1595"/>
			<arg value="/nostdlib"/> 	<!-- don't reference mscorlib -->
			<arg value="/noconfig"/>	<!-- don't reference ms assemblies -->
		</csc>

</target>


	<target name="test" depends="assemblies">

		<!--<exec program="..\..\..\nunit\NUnitConsole" commandline="MonoTests.AllTests,corlib_test.dll" failonerror="false"/>-->

		<exec program="..\..\..\nunit\NUnitConsole" commandline="MonoTests.AllTests,corlib_reference.dll" failonerror="false"/>
	</target>

	<target name="clean">
		<delete file="corlib_test.dll" failonerror="false"/>
		<delete file="RunTests.corlib.exe" failonerror="false"/>
		<delete file="corlib_linux_test.dll" failonerror="false"/>
		<delete file="corlib_reference.dll" failonerror="false"/>

		<delete file="corlib_test.pdb" failonerror="false"/>
		<delete file="RunTests.corlib.pdb" failonerror="false"/>
		<delete file="corlib_linux_test.pdb" failonerror="false"/>
		<delete file="corlib_reference.pdb" failonerror="false"/>
		
	</target>
</project>
